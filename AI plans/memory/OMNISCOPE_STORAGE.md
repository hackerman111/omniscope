# ğŸ—„ï¸ OMNISCOPE â€” ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğ°: ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

> Ğ­Ñ‚Ğ¾Ñ‚ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ Ğ¾Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¿ĞµÑ€ĞµÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ½ÑƒÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Omniscope.
> ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ: Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ¶Ğ¸Ğ²Ñ‘Ñ‚ **Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸**, Ğ° Ğ½Ğµ Ğ² `~/.local`.
> Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ â€” ĞºĞ°Ğº `.git` Ğ´Ğ»Ñ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ: Ğ·Ğ°ÑˆÑ‘Ğ» Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸, Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° ÑƒĞ¶Ğµ Ñ‚Ğ°Ğ¼.

---

## 0. Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ

### Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (Ğ¾Ñ‚Ğ²ĞµÑ€Ğ³Ğ½ÑƒÑ‚Ğ°)
```
~/.local/share/omniscope/     â† Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
~/Books/                      â† Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ½Ğ¸Ğ³
```
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ´Ğ²Ğ° Ğ¼ĞµÑÑ‚Ğ°. ĞŸĞµÑ€ĞµĞ½Ñ‘Ñ Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸ â€” Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ» ÑĞ²ÑĞ·ÑŒ Ñ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸.
Ğ¡Ğ´ĞµĞ»Ğ°Ğ» Ğ±ÑĞºĞ°Ğ¿ ĞºĞ½Ğ¸Ğ³ â€” Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ»Ğ¸. ĞĞµĞ¸Ğ½Ñ‚ÑƒĞ¸Ñ‚Ğ¸Ğ²Ğ½Ğ¾.

### ĞĞ¾Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
```
~/Books/
â”œâ”€â”€ .libr/                    â† Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ¶Ğ¸Ğ²Ñ‘Ñ‚ Ğ·Ğ´ĞµÑÑŒ, Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸
â”‚   â”œâ”€â”€ library.toml          â† Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
â”‚   â”œâ”€â”€ cards/                â† JSON-ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸
â”‚   â”œâ”€â”€ index/                â† tantivy + SQLite
â”‚   â””â”€â”€ ...
â”œâ”€â”€ programming/
â”‚   â”œâ”€â”€ rust/
â”‚   â”‚   â””â”€â”€ trpl.pdf
â”‚   â””â”€â”€ algorithms/
â””â”€â”€ ml-papers/
    â””â”€â”€ attention.pdf
```

ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:
- ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ğ» Ğ¿Ğ°Ğ¿ĞºÑƒ â€” Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ¿ĞµÑ€ĞµĞµÑ…Ğ°Ğ»Ğ° Ğ²Ğ¼ĞµÑÑ‚Ğµ Ñ Ğ½ĞµĞ¹
- `cp -r ~/Books /backup/` â€” Ğ±ÑĞºĞ°Ğ¿ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
- ĞĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ĞºĞ¾Ğ¼Ğ¿ÑŒÑÑ‚ĞµÑ€Ğµ
- ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾ Ğ±ĞµĞ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸: `.libr` = "ÑÑ‚Ğ¾ Ğ¿Ğ°Ğ¿ĞºĞ° Ñ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸ Ğ¿Ğ¾Ğ´ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ omniscope"

| ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---|---|
| **"Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° = Ğ¿Ğ°Ğ¿ĞºĞ°"** | `.libr/` Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸, ĞºĞ°Ğº `.git` Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ĞºĞ¾Ğ´Ğ¾Ğ¼ |
| **"ĞŸĞµÑ€ĞµĞ½Ğ¾ÑĞ¸ Ğ¿Ğ°Ğ¿ĞºÑƒ â€” Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ¸ÑˆÑŒ Ğ²ÑÑ‘"** | ĞĞµÑ‚ ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ² `~/.local` |
| **"Ğ‘ÑĞºĞ°Ğ¿ = Ğ¾Ğ´Ğ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ°"** | `tar -czf backup.tar.gz ~/Books/` â€” Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ |
| **"ĞĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº"** | ĞšĞ°Ğ¶Ğ´Ğ°Ñ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ° Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ° |

---

## 1. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° `.libr/` â€” Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾

```
{books_root}/
â””â”€â”€ .libr/
    â”‚
    â”œâ”€â”€ library.toml              ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚: Ğ¸Ğ¼Ñ, Ğ²ĞµÑ€ÑĞ¸Ñ ÑÑ…ĞµĞ¼Ñ‹, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
    â”œâ”€â”€ lock                      Lock-Ñ„Ğ°Ğ¹Ğ» (Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿)
    â”‚
    â”œâ”€â”€ cards/                    JSON-ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ ĞºĞ½Ğ¸Ğ³
    â”‚   â”œâ”€â”€ {uuid}.json
    â”‚   â”œâ”€â”€ {uuid}.json
    â”‚   â””â”€â”€ ...
    â”‚
    â”œâ”€â”€ db/
    â”‚   â”œâ”€â”€ omniscope.db          SQLite: books, tags, libraries, frecency, action_log
    â”‚   â””â”€â”€ tantivy/              Full-text Ğ¸Ğ½Ğ´ĞµĞºÑ
    â”‚       â”œâ”€â”€ meta.json
    â”‚       â””â”€â”€ ...
    â”‚
    â”œâ”€â”€ vectors/
    â”‚   â””â”€â”€ embeddings.usearch    HNSW Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ (ĞµÑĞ»Ğ¸ RAG Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½)
    â”‚
    â”œâ”€â”€ cache/
    â”‚   â”œâ”€â”€ covers/               ĞĞ±Ğ»Ğ¾Ğ¶ĞºĞ¸ ĞºĞ½Ğ¸Ğ³ {uuid}.jpg
    â”‚   â”œâ”€â”€ crossref/             ĞšÑÑˆ CrossRef API
    â”‚   â”œâ”€â”€ s2/                   ĞšÑÑˆ Semantic Scholar
    â”‚   â”œâ”€â”€ annas/                ĞšÑÑˆ Anna's Archive
    â”‚   â””â”€â”€ library_map.json      ĞšÑÑˆ Library Map Ğ´Ğ»Ñ AI
    â”‚
    â”œâ”€â”€ undo/
    â”‚   â””â”€â”€ action_log.jsonl      Ğ›Ğ¾Ğ³ AI-Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ñ snapshot_before
    â”‚
    â””â”€â”€ backups/
        â”œâ”€â”€ 2025-02-19_full.omnibak    ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ (Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ğ²)
        â””â”€â”€ 2025-02-19_full.omnibak.sha256
```

### 1.1 `library.toml` â€” Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

```toml
[library]
name = "My Library"
id = "ulid-01HXYZ..."          # Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ (Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)
version = 1                     # Ğ’ĞµÑ€ÑĞ¸Ñ ÑÑ…ĞµĞ¼Ñ‹ .libr/ (Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹)
created_at = "2025-02-19T10:00:00Z"
omniscope_version = "0.3.0"    # Ğ’ĞµÑ€ÑĞ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ²ÑˆĞ°Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ

[library.roots]
# Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ñ‹Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸ ÑÑ‚Ğ¾Ğ¹ Ğ¶Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
# ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¸Ğ¼ĞµÑ‚ÑŒ ĞºĞ½Ğ¸Ğ³Ğ¸ Ğ² Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ… Ğ¿Ğ¾Ğ´ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¾Ğ¹
extra = [
    "/media/external-drive/Books",
    "/home/user/Papers",
]

[settings]
# ĞŸĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ¹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
default_viewer_pdf = "zathura"
language = "en"
auto_index = true
```

---

## 2. ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ (Discovery)

Omniscope Ğ¸Ñ‰ĞµÑ‚ `.libr/` Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñƒ git: Ğ¾Ñ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ²Ğ²ĞµÑ€Ñ….

```rust
pub fn discover_library(start: &Path) -> Option<LibraryRoot> {
    // 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
    if let Ok(path) = std::env::var("OMNISCOPE_LIBRARY") {
        return Some(LibraryRoot::new(PathBuf::from(path)));
    }

    // 2. ĞŸĞ¾Ğ´Ğ½ÑÑ‚ÑŒÑÑ Ğ¾Ñ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ²Ğ²ĞµÑ€Ñ…
    let mut current = start.to_path_buf();
    loop {
        let candidate = current.join(".libr");
        if candidate.is_dir() && candidate.join("library.toml").exists() {
            return Some(LibraryRoot::new(current));
        }
        if !current.pop() {
            break;
        }
    }

    // 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº Ğ¸Ğ· Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°
    for path in global_config().known_libraries() {
        if path.join(".libr").exists() {
            return Some(LibraryRoot::new(path));
        }
    }

    None
}
```

**Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³** (`~/.config/omniscope/config.toml`) Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾:
- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº
- Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (Ñ‚ĞµĞ¼Ğ°, API-ĞºĞ»ÑÑ‡Ğ¸, viewer defaults)
- ĞĞ¸Ñ‡ĞµĞ³Ğ¾ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

```toml
# ~/.config/omniscope/config.toml

[global]
theme = "catppuccin-mocha"
default_editor = "$EDITOR"

[ai]
provider = "anthropic"
api_key_env = "ANTHROPIC_API_KEY"

# Ğ ĞµĞµÑÑ‚Ñ€ Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº
[[libraries]]
name = "My Library"
path = "/home/user/Books"
id = "ulid-01HXYZ..."

[[libraries]]
name = "Work Papers"
path = "/home/user/Papers"
id = "ulid-02HABC..."
```

---

## 3. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

### `omniscope init` â€” ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ

```bash
# Ğ’ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
cd ~/Books
omniscope init

# Ğ˜Ğ»Ğ¸ Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¿ÑƒÑ‚Ğ¸
omniscope init ~/Books
omniscope init ~/Books --name "My Library"

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
omniscope init ~/NewBooks --create-dir
```

```rust
pub async fn init_library(root: &Path, opts: InitOptions) -> Result<LibraryRoot> {
    // 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
    if opts.create_dir {
        tokio::fs::create_dir_all(root).await?;
    }

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
    ensure!(root.exists(), "Directory does not exist: {}", root.display());

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ Ğ½ĞµÑ‚ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
    let libr = root.join(".libr");
    ensure!(!libr.exists(), ".libr already exists in {}", root.display());

    // 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ .libr/
    for dir in &["cards", "db", "db/tantivy", "vectors", "cache",
                 "cache/covers", "cache/crossref", "cache/s2", "cache/annas",
                 "undo", "backups"] {
        tokio::fs::create_dir_all(libr.join(dir)).await?;
    }

    // 3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ library.toml
    let manifest = LibraryManifest {
        name: opts.name.unwrap_or_else(|| {
            root.file_name()
                .and_then(|n| n.to_str())
                .unwrap_or("My Library")
                .to_string()
        }),
        id: Ulid::new().to_string(),
        version: SCHEMA_VERSION,
        created_at: Utc::now(),
        omniscope_version: env!("CARGO_PKG_VERSION").to_string(),
        ..Default::default()
    };
    write_toml(&libr.join("library.toml"), &manifest).await?;

    // 4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ SQLite ÑÑ…ĞµĞ¼Ñƒ
    let db = SqlitePool::connect(&libr.join("db/omniscope.db").to_str().unwrap()).await?;
    sqlx::migrate!("./migrations").run(&db).await?;

    // 5. Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğµ
    global_config_mut().add_library(manifest.id.clone(), root.to_path_buf())?;

    // 6. ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
    if opts.scan_existing {
        scan_and_import_files(root, &db).await?;
    }

    println!("âœ“ Initialized omniscope library in {}", root.display());
    println!("  Run 'omniscope scan' to import existing files.");

    Ok(LibraryRoot::new(root.to_path_buf()))
}
```

**TUI flow Ğ´Ğ»Ñ `omniscope init`:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Initialize Omniscope Library                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Path:   /home/user/Books                                   â”‚
â”‚  Name:   [My Library                                      ] â”‚
â”‚                                                             â”‚
â”‚  â”Œ Options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [x] Scan existing files and create cards              â”‚  â”‚
â”‚  â”‚ [x] Auto-detect metadata from files                   â”‚  â”‚
â”‚  â”‚ [ ] Create standard folder structure                  â”‚  â”‚
â”‚  â”‚ [ ] Add to global registry                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚              [Cancel]    [Initialize â†’]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

Omniscope ÑƒĞ¼ĞµĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ğ°Ğ¿Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¾Ğ¹ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ.
ĞŸĞ°Ğ¿ĞºĞ¸ Ğ² `.libr` Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.

### 4.1 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¿Ğ¾Ğº

```bash
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ (Ğ¸ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ)
omniscope folder create programming/rust
omniscope folder create programming/rust --description "Rust books"

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½ÑƒÑ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ
omniscope folder create ml-papers/2024/transformers

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½ÑƒÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ (ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½)
omniscope folder scaffold --template research
omniscope folder scaffold --template personal
```

```rust
pub async fn create_folder(
    library: &LibraryRoot,
    path: &str,            // "programming/rust/async"
    opts: FolderCreateOpts,
) -> Result<FolderInfo> {

    // 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»ÑŒĞ½ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ
    let disk_path = library.root().join(path);
    tokio::fs::create_dir_all(&disk_path).await
        .context(format!("Failed to create directory: {}", disk_path.display()))?;

    // 2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² SQLite
    let folder = FolderInfo {
        id: Ulid::new().to_string(),
        path: path.to_string(),
        disk_path: disk_path.clone(),
        description: opts.description,
        created_at: Utc::now(),
        icon: opts.icon,
        color: opts.color,
    };
    db.insert_folder(&folder).await?;

    // 3. Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸ â€” Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ¸Ñ…
    for ancestor in path_ancestors(path) {
        if !db.folder_exists(ancestor).await? {
            db.insert_folder(&FolderInfo::from_path(ancestor)).await?;
        }
    }

    Ok(folder)
}
```

### 4.2 Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹

```rust
pub enum FolderTemplate {
    /// Ğ”Ğ»Ñ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹/ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ²
    Research,
    /// Ğ”Ğ»Ñ Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
    Personal,
    /// Ğ”Ğ»Ñ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ»Ğ¸Ñ‚ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ñ‹
    Technical,
    /// ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ (Ğ¸Ğ· TOML Ñ„Ğ°Ğ¹Ğ»Ğ°)
    Custom(PathBuf),
}

// Research ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚:
// papers/
//   â”œâ”€â”€ reading/
//   â”œâ”€â”€ read/
//   â”œâ”€â”€ to-read/
//   â”œâ”€â”€ by-topic/
//   â””â”€â”€ by-year/
// books/
//   â”œâ”€â”€ textbooks/
//   â””â”€â”€ reference/
// notes/

// Technical ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½:
// programming/
//   â”œâ”€â”€ rust/
//   â”œâ”€â”€ python/
//   â”œâ”€â”€ systems/
//   â””â”€â”€ algorithms/
// reference/
// courses/
```

```bash
# ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸ĞµĞ¼
omniscope folder scaffold --template research --dry-run

# â”€â”€ Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Will create:
#   ~/Books/papers/
#   ~/Books/papers/reading/
#   ~/Books/papers/read/
#   ~/Books/papers/to-read/
#   ~/Books/papers/by-topic/
#   ~/Books/papers/by-year/
#   ~/Books/books/
#   ~/Books/books/textbooks/
#   ~/Books/books/reference/
# Apply? [y/N]
```

### 4.3 Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ°Ğ¿Ğ¾Ğº: Ğ´Ğ¸ÑĞº â†” Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°

```rust
/// ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ¸ÑĞºĞ¾Ğ¼ Ğ¸ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
pub async fn sync_folders(library: &LibraryRoot) -> SyncReport {
    let disk_folders = scan_directories(library.root()).await;
    let db_folders = db.list_folders().await;

    let mut report = SyncReport::new();

    // ĞŸĞ°Ğ¿ĞºĞ¸ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ² Ğ‘Ğ”
    for folder in &disk_folders {
        if !db_folders.contains(folder) {
            report.new_on_disk.push(folder.clone());
        }
    }

    // ĞŸĞ°Ğ¿ĞºĞ¸ Ğ² Ğ‘Ğ”, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ (ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹)
    for folder in &db_folders {
        if !disk_folders.contains(folder) {
            report.missing_on_disk.push(folder.clone());
        }
    }

    // Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ¿Ñ€Ğ¸ĞºÑ€ĞµĞ¿Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ¸ Ğº ĞºĞ°ĞºĞ¾Ğ¹ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ
    let untracked = scan_untracked_files(library.root()).await;
    report.untracked_files = untracked;

    report
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYNC: Disk â†” Library                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“  12 folders in sync                                              â”‚
â”‚  âŠ•   3 new folders found on disk (not in library)                  â”‚
â”‚       programming/zig/         [Add to library]                     â”‚
â”‚       papers/2025/             [Add to library]                     â”‚
â”‚       archive/old/             [Add to library] [Ignore]            â”‚
â”‚  âŠ˜   1 folder in library missing on disk                            â”‚
â”‚       programming/haskell/     [Remove from library] [Recreate dir] â”‚
â”‚  ï¼Ÿ  7 untracked files (no card)                                     â”‚
â”‚       book_without_card.pdf    [Create card] [Ignore]               â”‚
â”‚       ...                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Sync All] [Review Each] [Auto-fix Safe Issues]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±ÑĞºĞ°Ğ¿Ğ°

### 5.1 Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ Ğ±ÑĞºĞ°Ğ¿Ğ°

```rust
pub enum BackupFormat {
    /// ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ğ² (.omnibak)
    /// Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚: Ğ²ÑĞµ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ + SQLite + Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ + Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
    /// ĞĞ• ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚: Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ½Ğ¸Ğ³ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
    Full,

    /// ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ğ² Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ½Ğ¸Ğ³ (.omnibak.full)
    /// ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼
    WithFiles,

    /// Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ² Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾Ğ¼ JSON (.omniexport)
    /// ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ, Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€
    CardsOnly,

    /// Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ + ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ°Ğ¿Ğ¾Ğº
    /// Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
    Skeleton,
}

pub struct BackupManifest {
    pub version: u32,
    pub created_at: DateTime<Utc>,
    pub omniscope_version: String,
    pub library_name: String,
    pub library_id: String,
    pub format: BackupFormat,
    pub stats: BackupStats,
    pub checksum: String,       // SHA-256 Ğ²ÑĞµĞ³Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°
    pub encrypted: bool,
}

pub struct BackupStats {
    pub total_books: u32,
    pub with_files: u32,
    pub libraries_count: u32,
    pub folders_count: u32,
    pub tags_count: u32,
    pub total_size_bytes: u64,
}
```

### 5.2 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ°

```bash
# Ğ‘ÑĞºĞ°Ğ¿ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹, Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹)
omniscope backup create
omniscope backup create --output ~/backups/library.omnibak
omniscope backup create --format cards-only

# Ğ‘ÑĞºĞ°Ğ¿ Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸ (Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹, Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹)
omniscope backup create --with-files --output ~/backups/full.omnibak

# ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ±ÑĞºĞ°Ğ¿ Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ
omniscope backup schedule --interval weekly --keep 4 --output ~/backups/

# Ğ—Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿
omniscope backup create --encrypt --password-env BACKUP_PASSWORD

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿Ğ°
omniscope backup verify ~/backups/library.omnibak
```

```rust
pub async fn create_backup(library: &LibraryRoot, opts: BackupOptions) -> Result<PathBuf> {
    let output = opts.output.unwrap_or_else(|| {
        library.libr_dir()
            .join("backups")
            .join(format!("{}_backup.omnibak", Utc::now().format("%Y-%m-%d")))
    });

    let mut archive = BackupArchive::new(&output, opts.format)?;

    // 1. Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚
    let stats = gather_stats(library).await?;
    archive.write_manifest(&BackupManifest::new(library, opts.format, stats))?;

    // 2. Ğ’ÑĞµ JSON-ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸
    for card_path in list_cards(library).await? {
        archive.add_file("cards/", &card_path)?;
    }

    // 3. SQLite Ğ´Ğ°Ğ¼Ğ¿ (Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ñ‹Ğ¹, Ğ½Ğµ Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ‘Ğ”)
    let sql_dump = dump_sqlite_portable(library).await?;
    archive.write_bytes("db/dump.sql", &sql_dump)?;

    // 4. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ°Ğ¿Ğ¾Ğº
    let folder_tree = export_folder_tree(library).await?;
    archive.write_json("structure/folders.json", &folder_tree)?;

    // 5. Ğ¢ĞµĞ³Ğ¸ Ğ¸ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
    archive.write_json("structure/tags.json", &export_tags(library).await?)?;
    archive.write_json("structure/libraries.json", &export_libraries(library).await?)?;

    // 6. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (library.toml Ğ±ĞµĞ· ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²)
    archive.add_file("config/", &library.libr_dir().join("library.toml"))?;

    // 7. Ğ¤Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ½Ğ¸Ğ³ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
    if opts.include_files {
        for book in books_with_files(library).await? {
            archive.add_file("files/", &book.file.path)?;
        }
    }

    // 8. Ğ—Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
    if let Some(password) = opts.password {
        archive.encrypt(&password)?;
    }

    // 9. Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ SHA-256
    let checksum = archive.finalize()?;
    tokio::fs::write(output.with_extension("omnibak.sha256"),
                     checksum.to_hex()).await?;

    Ok(output)
}
```

### 5.3 Ğ’Ğ¾ÑÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°

ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ: `omniscope restore`. Ğ£Ğ¼ĞµĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ² Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°Ñ….

```bash
# ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ğ½Ğ¾Ğ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
omniscope restore ~/backups/library.omnibak --into ~/Books-restored

# Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ (merge)
omniscope restore ~/backups/library.omnibak --into ~/Books --mode merge

# Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ (Ğ¿Ğ°Ğ¿ĞºĞ¸ + Ñ‚ĞµĞ³Ğ¸ + Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸, Ğ±ĞµĞ· ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº)
omniscope restore ~/backups/library.omnibak --skeleton-only

# Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½ÑƒÑ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ/Ñ‚ĞµĞ³
omniscope restore ~/backups/library.omnibak --filter "library:programming"
omniscope restore ~/backups/library.omnibak --filter "tag:rust"

# Preview Ñ‡Ñ‚Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾
omniscope restore ~/backups/library.omnibak --dry-run
```

```rust
pub async fn restore_library(
    backup_path: &Path,
    opts: RestoreOptions,
) -> Result<RestoreReport> {

    // 1. ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¸ Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿
    let archive = BackupArchive::open(backup_path)?;
    archive.verify_checksum()?;
    let manifest = archive.read_manifest()?;

    println!("ğŸ“¦ Backup: {} ({} books, created {})",
             manifest.library_name,
             manifest.stats.total_books,
             manifest.created_at.format("%Y-%m-%d"));

    // 2. ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»ĞµĞ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
    let target = &opts.into;
    match opts.mode {
        RestoreMode::Fresh => {
            // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‡Ğ¸ÑÑ‚ÑƒÑ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ
            ensure!(!target.join(".libr").exists(),
                    "Target already has a .libr directory. Use --mode merge or choose different path.");
            init_library(target, InitOptions::minimal()).await?;
        }
        RestoreMode::Merge => {
            // Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ Ñ‡Ñ‚Ğ¾ Ñ†ĞµĞ»ÑŒ â€” Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°
            ensure!(target.join(".libr").exists(),
                    "Target is not an omniscope library. Run 'omniscope init' first.");
        }
        RestoreMode::SkeletonOnly => {
            if !target.join(".libr").exists() {
                init_library(target, InitOptions::minimal()).await?;
            }
        }
    }

    let library = LibraryRoot::open(target)?;
    let mut report = RestoreReport::new();

    // 3. Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ğ°Ğ¿Ğ¾Ğº (Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼)
    let folder_tree: Vec<FolderInfo> = archive.read_json("structure/folders.json")?;
    for folder in &folder_tree {
        let disk_path = target.join(&folder.path);
        tokio::fs::create_dir_all(&disk_path).await?;
        db.upsert_folder(folder).await?;
        report.folders_restored += 1;
    }

    // 4. Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ³Ğ¸
    let tags: Vec<Tag> = archive.read_json("structure/tags.json")?;
    for tag in &tags {
        db.upsert_tag(tag).await?;
        report.tags_restored += 1;
    }

    // 5. Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ (Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ)
    let libraries: Vec<Library> = archive.read_json("structure/libraries.json")?;
    for lib in &libraries {
        db.upsert_library(lib).await?;
        report.libraries_restored += 1;
    }

    if opts.mode == RestoreMode::SkeletonOnly {
        return Ok(report);
    }

    // 6. Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ ĞºĞ½Ğ¸Ğ³
    for card_entry in archive.list_cards()? {
        let mut card: BookCard = archive.read_json(&card_entry)?;

        // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹ Ğ¿Ñ€Ğ¸ merge
        if opts.mode == RestoreMode::Merge {
            if let Some(existing) = db.find_by_id(&card.id).await? {
                match opts.conflict {
                    ConflictStrategy::SkipExisting => {
                        report.skipped += 1;
                        continue;
                    }
                    ConflictStrategy::OverwriteWithBackup => {
                        // ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
                    }
                    ConflictStrategy::KeepNewer => {
                        if existing.updated_at > card.updated_at {
                            report.skipped += 1;
                            continue;
                        }
                    }
                    ConflictStrategy::AskUser => {
                        // Ğ’ TUI Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³
                        // Ğ’ CLI â€” Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² report.conflicts
                        report.conflicts.push(card.id.clone());
                        continue;
                    }
                }
            }
        }

        // ĞŸĞµÑ€ĞµĞ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ ĞµÑĞ»Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ½ĞµÑĞµĞ½Ñ‹
        if let Some(file) = &mut card.file {
            let new_path = target.join(
                file.path.strip_prefix(&manifest.original_root)
                    .unwrap_or(&file.path)
            );
            if new_path.exists() {
                file.path = new_path;
                report.files_relinked += 1;
            } else {
                file.path = new_path;  // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¿ÑƒÑ‚ÑŒ, Ñ„Ğ°Ğ¹Ğ» ĞµÑ‰Ñ‘ Ğ½Ğµ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
                report.files_missing += 1;
            }
        }

        db.upsert_card(&card).await?;
        write_card_json(&library, &card).await?;
        report.cards_restored += 1;
    }

    // 7. Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ½Ğ¸Ğ³ (ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ¸ Ğ² Ğ±ÑĞºĞ°Ğ¿Ğµ)
    if archive.has_files() {
        for file_entry in archive.list_files()? {
            let dest = target.join(&file_entry.relative_path);
            tokio::fs::create_dir_all(dest.parent().unwrap()).await?;
            archive.extract_file(&file_entry, &dest)?;
            report.files_restored += 1;
        }
    }

    // 8. ĞŸĞµÑ€ĞµÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
    rebuild_tantivy_index(&library).await?;
    // Ğ­Ğ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³Ğ¸ Ğ½Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ (Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ)

    println!("{}", report.summary());
    Ok(report)
}
```

### 5.4 TUI Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”„ RESTORE LIBRARY                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Backup:   ~/backups/2025-02-19_backup.omnibak         [Browse...]  â”‚
â”‚  âœ“ Valid backup â€” SHA-256 verified                                  â”‚
â”‚                                                                     â”‚
â”‚  Content:                                                           â”‚
â”‚    147 books   |   8 libraries   |   34 tags   |   23 folders       â”‚
â”‚    Created: 2025-02-19  |  Format: Full (no files)                  â”‚
â”‚                                                                     â”‚
â”‚  Restore into:  [/home/user/Books-restored            ] [Browse...] â”‚
â”‚                                                                     â”‚
â”‚  Mode:                                                              â”‚
â”‚    (â—) Fresh â€” create new library from backup                       â”‚
â”‚    ( ) Merge â€” merge with existing library                          â”‚
â”‚    ( ) Skeleton only â€” folders + tags + structure (no book cards)   â”‚
â”‚                                                                     â”‚
â”‚  On conflict (for merge):                                           â”‚
â”‚    (â—) Keep newer   ( ) Skip existing   ( ) Overwrite              â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [x] Restore folder structure         (23 folders)           â”‚   â”‚
â”‚  â”‚ [x] Restore tags and libraries       (34 tags, 8 libs)      â”‚   â”‚
â”‚  â”‚ [x] Restore book cards               (147 cards)            â”‚   â”‚
â”‚  â”‚ [ ] Copy files from backup           (no files in backup)   â”‚   â”‚
â”‚  â”‚ [x] Rebuild search index after restore                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  [Dry Run â†’]                        [Restore â†’]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 Dry-run Ğ²Ñ‹Ğ²Ğ¾Ğ´

```
$ omniscope restore ~/backups/library.omnibak --into ~/Books-new --dry-run

ğŸ“¦ Backup Analysis
  Library: "My Library" (147 books, created 2025-02-19)
  Format: Full (no files included)
  Checksum: âœ“ Valid

ğŸ“ Will create directory: /home/user/Books-new
ğŸ“ Will initialize .libr/ in /home/user/Books-new

ğŸ“‚ Folder structure (23 folders):
  + programming/
  + programming/rust/
  + programming/rust/official/
  + programming/algorithms/
  + ml-papers/
  + ml-papers/transformers/
  + ml-papers/rl/
  ... and 16 more

ğŸ·  Tags (34):
  + rust, python, algorithms, systems, async, transformers ... (+28)

ğŸ“š Books (147):
  + The Rust Programming Language (Klabnik 2023) [pdf â€” file not in backup]
  + Attention Is All You Need (Vaswani 2017)     [pdf â€” file not in backup]
  ... and 145 more

âš   Files not included in backup:
   147 books have file references but files were not backed up.
   After restore, cards will point to: /home/user/Books-new/{original_relative_path}
   Run 'omniscope sync' after copying your files to relink them.

ğŸ“Š Summary (dry run):
  Folders:   23 created
  Tags:      34 restored
  Libraries:  8 restored
  Cards:    147 restored
  Files:      0 (not in backup)
  Index:    rebuilt after restore

Run without --dry-run to apply.
```

---

## 6. Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

ĞŸÑ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ `omniscope init` Ğ¸Ğ»Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ñ‡ĞµÑ€ĞµĞ· `omniscope scan`.

```bash
# Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ½ĞµĞ²ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸
omniscope scan

# Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ
omniscope scan ~/Books/programming/

# Ğ¡ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº
omniscope scan --auto-create-cards

# Ğ¡ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸ĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ)
omniscope scan --extract-metadata

# Ğ¡ Ğ¾Ğ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸ĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ API (ĞµÑ‰Ñ‘ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ)
omniscope scan --enrich
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‚ SCANNING ~/Books/...                              [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 47%]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Found:    234 files                                                â”‚
â”‚  Known:     89 (already have cards)                                 â”‚
â”‚  New:      145 (no card yet)                                        â”‚
â”‚  Ignored:    0                                                      â”‚
â”‚                                                                     â”‚
â”‚  Currently: programming/algorithms/taocp-vol1.pdf                  â”‚
â”‚             â†’ Extracting PDF metadata...                            â”‚
â”‚             â†’ Title: "The Art of Computer Programming, Vol. 1"     â”‚
â”‚             â†’ Author: Knuth, Donald E.                              â”‚
â”‚             â†’ ISBN found: 978-0-201-89683-1                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Pause]  [Cancel]  [Skip metadata extraction]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ĞĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº

Omniscope Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº.

```bash
# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº
omniscope libraries
# â†’  My Library        ~/Books          (147 books)  [current]
# â†’  Work Papers       ~/Papers         (89 books)
# â†’  Archive           /mnt/nas/Books   (312 books)

# ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³ÑƒÑ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ
omniscope switch "Work Papers"
omniscope switch ~/Papers

# ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ TUI Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¾Ğ¹
omniscope --library ~/Papers

# Ğ—Ğ°Ğ±Ñ‹Ñ‚ÑŒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ Ğ¸Ğ· Ñ€ĞµĞµÑÑ‚Ñ€Ğ° (Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹)
omniscope libraries forget ~/old/path
```

**ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²:**
```bash
OMNISCOPE_LIBRARY=~/Papers omniscope book list --json
```

**TUI Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ÑŒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº (`gb` â€” go buffers):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LIBRARIES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¶ My Library          ~/Books   147  â”‚
â”‚    Work Papers         ~/Papers   89  â”‚
â”‚    Archive             /mnt/nas  312  â”‚
â”‚                                        â”‚
â”‚  [Enter] switch  [i] init new  [f] forgetâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

```bash
# ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ Ğ² Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¼ĞµÑÑ‚Ğ¾
# (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ mv â€” .libr/ Ğ¿ĞµÑ€ĞµĞµĞ´ĞµÑ‚ Ğ²Ğ¼ĞµÑÑ‚Ğµ Ñ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸)
mv ~/Books ~/NewLocation/Books

# ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿ÑƒÑ‚ÑŒ Ğ² Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ€ĞµĞµÑÑ‚Ñ€Ğµ
omniscope libraries update-path ~/Books --new-path ~/NewLocation/Books

# Ğ˜Ğ»Ğ¸ â€” omniscope ÑĞ°Ğ¼ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ñ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ:
cd ~/NewLocation/Books
omniscope    # ĞĞ°Ğ¹Ğ´Ñ‘Ñ‚ .libr/ Ğ·Ğ´ĞµÑÑŒ, Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ Ñ€ĞµĞµÑÑ‚Ñ€ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
```

```rust
/// ĞŸÑ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ Ğ¿ÑƒÑ‚ÑŒ Ğ² Ñ€ĞµĞµÑÑ‚Ñ€Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ñ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼
fn reconcile_library_path(discovered: &Path, registered: &Option<PathBuf>) {
    if let Some(reg) = registered {
        if reg != discovered {
            // ĞŸÑƒÑ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞµÑÑ‚Ñ€ Ğ¼Ğ¾Ğ»Ñ‡Ğ°
            global_config_mut().update_library_path(reg, discovered);
            log::info!("Library moved from {} to {}", reg.display(), discovered.display());
        }
    } else {
        // ĞĞ¾Ğ²Ğ°Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° â€” Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
        global_config_mut().add_library_from_path(discovered);
    }
}
```

---

## 9. Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `AI_PLAN.md`

**Â§2.2 Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ** â€” Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ°:
```
{books_root}/
â””â”€â”€ .libr/
    â”œâ”€â”€ library.toml
    â”œâ”€â”€ cards/{uuid}.json
    â”œâ”€â”€ db/omniscope.db
    â”œâ”€â”€ db/tantivy/
    â”œâ”€â”€ cache/covers/
    â”œâ”€â”€ undo/action_log.jsonl
    â””â”€â”€ backups/

~/.config/omniscope/config.toml    (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ + Ñ€ĞµĞµÑÑ‚Ñ€)
```

**Â§17 SLA** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ:
- `omniscope init` < 500ms Ğ´Ğ»Ñ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
- `omniscope scan` (Ğ±ĞµĞ· Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…) < 10ms/Ñ„Ğ°Ğ¹Ğ»
- `omniscope restore` (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸, Ğ±ĞµĞ· Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²) < 1s/100 ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº

**Â§18 CLI** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:
```bash
omniscope init [path]                     # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ
omniscope scan [--extract-metadata]       # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹
omniscope sync                            # Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¸ÑĞº â†” Ğ‘Ğ”
omniscope libraries                       # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº
omniscope libraries forget [path]         # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Ñ€ĞµĞµÑÑ‚Ñ€Ğ°
omniscope switch [name|path]              # ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºÑƒ
omniscope backup create [--with-files]    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿
omniscope backup restore [path]           # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
omniscope backup verify [path]            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ
omniscope backup schedule [--interval]    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ±ÑĞºĞ°Ğ¿
```

### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `MASTER_PLAN.md`

**Ğ¤Ğ°Ğ·Ğ° 0** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Â§0.4:
```
â–¡ LibraryRoot::discover() â€” Ğ¿Ğ¾Ğ¸ÑĞº .libr/ Ğ¾Ñ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ²Ğ²ĞµÑ€Ñ…
â–¡ omniscope init â€” Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ wizard
â–¡ omniscope scan â€” ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
â–¡ Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞµÑÑ‚Ñ€ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº Ğ² ~/.config/omniscope/config.toml
â–¡ Reconcile Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ (Ğ°Ğ²Ñ‚Ğ¾Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒÑ‚Ğ¸ Ğ¿Ğ¾ÑĞ»Ğµ mv)
â–¡ Ğ¢ĞµÑÑ‚: init â†’ mv â†’ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ â€” Ğ¿ÑƒÑ‚ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
```

**Ğ¤Ğ°Ğ·Ğ° 1** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Â§1.5:
```
â–¡ create_folder() ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ
â–¡ sync_folders(): Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ¸ÑĞº â†” Ğ‘Ğ”
â–¡ FolderTemplate::scaffold() â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ¾Ğ²Ñ‹Ñ… ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€
â–¡ TUI sync-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ: âŠ• Ğ½Ğ¾Ğ²Ñ‹Ğµ / âŠ˜ Ğ¿Ñ€Ğ¾Ğ¿Ğ°Ğ²ÑˆĞ¸Ğµ / ï¼Ÿ Ğ½ĞµĞ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
```

**Ğ¤Ğ°Ğ·Ğ° 5** â€” Ğ¿ĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² "Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚/Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ + Ğ‘ÑĞºĞ°Ğ¿", Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ:
```
â–¡ BackupArchive: create, open, verify
â–¡ omniscope backup create / restore / verify / schedule
â–¡ RestoreMode: Fresh / Merge / SkeletonOnly
â–¡ ConflictStrategy: SkipExisting / OverwriteWithBackup / KeepNewer
â–¡ Dry-run Ğ´Ğ»Ñ restore Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ¼
â–¡ Ğ¢ĞµÑÑ‚: backup â†’ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ .libr/ â†’ restore â†’ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°
```

---

## 10. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ `.omnibak` â€” Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
[4 bytes]  Magic: 0x4F4D4E49 ("OMNI")
[4 bytes]  Format version: 1
[4 bytes]  Flags: 0x01=encrypted, 0x02=compressed, 0x04=with_files
[8 bytes]  Timestamp (Unix, little-endian)
[4 bytes]  Manifest length
[N bytes]  Manifest (JSON, gzip compressed)
[4 bytes]  TOC length
[N bytes]  Table of Contents (JSON ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ offsets)
[N bytes]  Payload (Ğ²ÑĞµ Ñ„Ğ°Ğ¹Ğ»Ñ‹, ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ gzip compressed)
[32 bytes] SHA-256 Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾
```

Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ `.omniexport` â€” ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ `.tar.gz` Ñ Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¾Ğ¹. ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ»ÑĞ±Ñ‹Ğ¼ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ¸ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ.

---

*`.libr/` â€” ÑÑ‚Ğ¾ Ğ½Ğµ ÑĞºÑ€Ñ‹Ñ‚Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ Ğ¼Ğ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸. Ğ­Ñ‚Ğ¾ Ñ‚Ğ²Ğ¾Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°, Ğ¶Ğ¸Ğ²ÑƒÑ‰Ğ°Ñ Ñ€ÑĞ´Ğ¾Ğ¼ Ñ Ñ‚Ğ²Ğ¾Ğ¸Ğ¼Ğ¸ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸, Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ°Ñ Ğ¸ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ¸Ğ¼Ğ°Ñ.*
