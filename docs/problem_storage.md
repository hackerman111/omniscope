# –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –∂—É—Ä–Ω–∞–ª: Storage Architecture ‚Äî Phase B & C

–î–∞—Ç–∞: 2026-02-20  
–ö–æ–Ω—Ç–µ–∫—Å—Ç: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Phase A (Core Library Foundation), Phase B (Folder Management) –∏ Phase C (File Scanning).

---

## üèóÔ∏è Phase A: Core Library Foundation (–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è)

### –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫ `.libr/`

**–ó–∞–¥–∞—á–∞:**  
–ò–∑–º–µ–Ω–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (`~/.local/share/omniscope`) –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é "Git-like" –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (–ø–∞–ø–∫–∞ `.libr/` –≤–Ω—É—Ç—Ä–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∫–Ω–∏–≥–∞–º–∏).

**–ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:**

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`AppConfig` vs `GlobalConfig`)**
   - *–ü—Ä–æ–±–ª–µ–º–∞:* –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ `AppConfig` –æ—Ç–≤–µ—á–∞–ª –∑–∞ –≤—Å—ë: —Ç–µ–º—É, —Å–æ—á–µ—Ç–∞–Ω–∏—è –∫–ª–∞–≤–∏—à, –∏ –ø—É—Ç–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö/–∫—ç—à—É. –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ `.libr/` –ø—É—Ç–∏ —Å—Ç–∞–ª–∏ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∞ –Ω–µ –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.
   - *–†–µ—à–µ–Ω–∏–µ:* –°–æ–∑–¥–∞–Ω `GlobalConfig`, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `~/.config/omniscope/config.toml` –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–µ—Å—Ç—Ä –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫. `LibraryRoot` –≤–∑—è–ª –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏.
   - *–ú—ã—Å–ª—å:* –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (state) –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π (preferences). –£–ª—É—á—à–∏–ª–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Ö–æ—Ç—å –∏ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—É—Ç–µ–π –≤ TUI.

2. **–ê–ª–≥–æ—Ä–∏—Ç–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (`discover`)**
   - *–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:* –ù–∞–ø–∏—Å–∞–Ω —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫: –Ω–∞—á–∏–Ω–∞–µ–º —Å —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (`pwd`) –∏ –∏–¥–µ–º –≤–≤–µ—Ä—Ö –∫ –∫–æ—Ä–Ω—é –¥–µ—Ä–µ–≤–∞, –∏—â–∞ –ø–∞–ø–∫—É `.libr`.
   - *–ù—é–∞–Ω—Å:* –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `OMNISCOPE_LIBRARY` –¥–ª—è —è–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è. –í Rust 2024 —Ä–∞–±–æ—Ç–∞ —Å `std::env::set_var` —Å—Ç–∞–ª–∞ `unsafe`, –ø–æ—ç—Ç–æ–º—É –≤ —Ç–µ—Å—Ç–∞—Ö –ø—Ä–∏—à–ª–æ—Å—å –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω—ã–º `unsafe` –±–ª–æ–∫–æ–º, —á—Ç–æ–±—ã –ø–æ–¥–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –≠—Ç–æ –Ω–∞–ø–æ–º–Ω–∏–ª–æ, —á—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö –Ω—É–∂–Ω–æ –º–æ–∫–∞—Ç—å —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, –∞ –Ω–µ –º–µ–Ω—è—Ç—å –Ω–∞–ø—Ä—è–º—É—é.

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏**
   - *–†–µ—à–µ–Ω–∏–µ:* –ë—ã–ª–æ —Ä–µ—à–µ–Ω–æ **–Ω–µ –ø–∏—Å–∞—Ç—å** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –º–∏–≥—Ä–∞—Ü–∏—é —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ `~/.local/share/` –≤ –Ω–æ–≤—É—é `.libr/`. –ü—Ä–∏—á–∏–Ω–∞: –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ —Å–ª–∏—à–∫–æ–º —Ä–∞–∑–Ω—ã–µ. –ú–µ–Ω—å—à–µ –±–∞–≥–æ–≤, –ø—Ä–æ—â–µ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞—Ç—å `omniscope init` –∑–∞–Ω–æ–≤–æ. –í TUI –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `[No Library Found]`, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É –≤–Ω–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ –∫–∞–∫ –æ–Ω–∏ —Ä–µ—à–∞–ª–∏—Å—å

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `FolderAction` –∏ `Commands::Folder` –≤ CLI

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**  
–í `omniscope-cli/src/main.rs` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –≤–∞—Ä–∏–∞–Ω—Ç `Commands::Folder` —Å enum `FolderAction { List, Create, Delete, Rename }`. –Ø –Ω–µ –∑–∞–º–µ—Ç–∏–ª —ç—Ç–æ–≥–æ –∏ –¥–æ–±–∞–≤–∏–ª –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç `Commands::Folder` –∏ –≤—Ç–æ—Ä–æ–π enum `FolderAction { Scaffold, Sync }`.

–≠—Ç–æ –¥–∞–ª–æ 16 –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:
```
error[E0428]: the name `Folder` is defined multiple times
error[E0428]: the name `FolderAction` is defined multiple times
error[E0119]: conflicting implementations of trait `FromArgMatches`
error[E0220]: associated type `List` not found for `Self`
...
```

**–ü–æ—á–µ–º—É —Ç–∞–∫ –ø–æ–ª—É—á–∏–ª–æ—Å—å:**  
–Ø –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ (—Å—Ç—Ä–æ–∫–∏ 1‚Äì155) –∏ –∫–æ–Ω–µ—Ü (–≥–¥–µ –º–æ–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è), –Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π `FolderAction` –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ (~—Å—Ç—Ä–æ–∫–∞ 272) ‚Äî –≤–Ω–µ –∑–æ–Ω—ã –º–æ–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –Ø –±—É–∫–≤–∞–ª—å–Ω–æ –Ω–µ –∑–Ω–∞–ª, —á—Ç–æ –æ–Ω —Ç–∞–º –µ—Å—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**  
1. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π `Commands::Folder` –≤–∞—Ä–∏–∞–Ω—Ç.
2. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π `enum FolderAction`.
3. –î–æ–±–∞–≤–∏—Ç—å `Scaffold` –∏ `Sync` –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π `FolderAction`.
4. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `match Commands::Folder`.

**–£—Ä–æ–∫:**  
–ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ enum/–≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤ –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª ‚Äî –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å `grep_search` –ø–æ –∏–º–µ–Ω–∏. –ù–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—á–∞–ª–∞ —Ñ–∞–π–ª–∞.

---

### 2. Borrow Checker –≤ `scan.rs`: –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ vs. –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**  
–ë—Ä–∞–ª—Å—è `ref file` –∏–∑ `card.file` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—É—Ç–∏, –∞ –∑–∞—Ç–µ–º `card` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è move –≤ `create_card_from_import()`. Rust –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —ç—Ç–æ, –ø–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.

```rust
// –û–®–ò–ë–û–ß–ù–´–ô –ö–û–î:
if let Some(ref file) = card.file {          // borrow –Ω–∞—á–∞—Ç
    result.new_files.push(PathBuf::from(&file.path));
    match create_card_from_import(db, card) { // ERROR: move –ø–æ–∫–∞ –∞–∫—Ç–∏–≤–µ–Ω borrow
        Err(e) => result.errors.push((PathBuf::from(&file.path), ...)) // borrow –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–Ω–æ–≤–∞
    }
}
```

–û—à–∏–±–∫–∞:
```
error[E0505]: cannot move out of `card` because it is borrowed
```

**–†–µ—à–µ–Ω–∏–µ:**  
–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å *–¥–æ* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `card`:
```rust
if let Some(ref file) = card.file {
    let file_path = PathBuf::from(&file.path); // –∫–ª–æ–Ω –ø—É—Ç–∏ —Å–¥–µ–ª–∞–Ω
    result.new_files.push(file_path.clone());
    // borrow `file` –∑–¥–µ—Å—å –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, card –º–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å
    match create_card_from_import(db, card) {
        Err(e) => result.errors.push((file_path, e.to_string())),
    }
}
```

**–£—Ä–æ–∫:**  
–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω Rust: –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–∞–º—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É–¥–∞-—Ç–æ, ‚Äî –≤—ã—Ç–∞—â–∏ –¥–∞–Ω–Ω—ã–µ (clone/copy) *–¥–æ* move. Borrow –∏ move –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç.

---

### 3. `list_folders` –≤–æ–∑–≤—Ä–∞—â–∞–ª `Folder` –±–µ–∑ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è `disk_path`

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**  
–Ø –¥–æ–±–∞–≤–∏–ª –∫–æ–ª–æ–Ω–∫—É `disk_path` –≤ —Å—Ö–µ–º—É –ë–î (migration v3) –∏ –ø–æ–ª–µ –≤ struct `Folder`, –Ω–æ –∑–∞–±—ã–ª –æ–±–Ω–æ–≤–∏—Ç—å —Å–∞–º SQL-–∑–∞–ø—Ä–æ—Å –≤ `list_folders()`. –¢–∞–º –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å `SELECT id, name, parent_id, library_id` –±–µ–∑ `disk_path`, –∏ –º–∞–ø–ø–∏–Ω–≥ `row.get(4)?` –ø—Ä–æ—Å—Ç–æ –Ω–µ –±—ã–ª–æ.

–≠—Ç–æ –Ω–µ –≤—ã–∑–≤–∞–ª–æ –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (Rust –Ω–µ –∑–Ω–∞–µ—Ç —á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ SQL), –Ω–æ –ø—Ä–∏–≤–µ–ª–æ –±—ã –∫ —Ç–æ–º—É, —á—Ç–æ `disk_path` –≤—Å–µ–≥–¥–∞ `None` –¥–∞–∂–µ —É –ø–∞–ø–æ–∫ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –ø–æ–ª–µ–º.

**–†–µ—à–µ–Ω–∏–µ:**  
–û–±–Ω–æ–≤–∏—Ç—å SQL (`SELECT id, name, parent_id, library_id, disk_path`) –∏ –¥–æ–±–∞–≤–∏—Ç—å `disk_path: row.get(4)?` –≤ –º–∞–ø–ø–∏–Ω–≥.

**–£—Ä–æ–∫:**  
–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ struct + —Å—Ö–µ–º–∞ + SQL-–∑–∞–ø—Ä–æ—Å—ã –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ –∑–∞ –æ–¥–∏–Ω —à–∞–≥. –ò–Ω–∞—á–µ –ª–µ–≥–∫–æ –∑–∞–±—ã—Ç—å –æ–¥–∏–Ω –∏–∑ —É—Ä–æ–≤–Ω–µ–π.

---

### 4. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã (warnings)

–ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞ –ø–æ—è–≤–∏–ª–∏—Å—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
- `OmniscopeError` –≤ `folders.rs` ‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª "–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π", –Ω–æ –≤—Å–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —à–ª–∏ —á–µ—Ä–µ–∑ —Ç—Ä–µ–π—Ç `From`, –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ç–∏–ø–∞.
- `Path` –≤ `scan.rs` ‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª `{Path, PathBuf}`, –Ω–æ `Path` –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —è–≤–Ω–æ.

–§–æ—Ä–º–∞–ª—å–Ω–æ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –∑–∞—Å–æ—Ä—è–µ—Ç build output –∏ –º–µ—à–∞–µ—Ç –∑–∞–º–µ—á–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ warnings. –£–±—Ä–∞–Ω–æ.

---

## üí≠ –ú—ã—Å–ª–∏ –æ –¥–∏–∑–∞–π–Ω–µ

### –ü–æ—Ä—è–¥–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—á–∏ —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º –≤ –ë–î

–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ (–∫–æ—Ç–æ—Ä–æ–º—É —è –Ω–µ —Å–ª–µ–¥–æ–≤–∞–ª —Å—Ç—Ä–æ–≥–æ):

1. **–°—Ö–µ–º–∞ –ë–î** ‚Äî migration + index.
2. **Struct** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ.
3. **–í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã** ‚Äî SELECT/INSERT/UPDATE.
4. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** ‚Äî –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
5. **–ü—É–±–ª–∏—á–Ω—ã–π API** ‚Äî `lib.rs`, `mod.rs`.
6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî CLI / TUI.

–Ø –Ω–∞–ø–∏—Å–∞–ª –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (`folders.rs`, `scan.rs`) –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –¥–æ–±–∞–≤–∏–ª DB –º–µ—Ç–æ–¥—ã –∏ –º–∏–≥—Ä–∞—Ü–∏—é. –ü–æ—Ç–æ–º –ø—Ä–∏—à–ª–æ—Å—å –¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö PR-style –ø—Ä–∞–≤–æ–∫ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ ‚Äî –Ω–∞—á–∏–Ω–∞—Ç—å —Å –Ω–∏–∂–Ω–µ–≥–æ —Å–ª–æ—è (–ë–î), –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–≤–µ—Ä—Ö.

---

### `sync_folders`: –æ—Ç—á—ë—Ç vs. —Ä–µ–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —è –¥—É–º–∞–ª —Å–¥–µ–ª–∞—Ç—å `sync_folders` —Ñ—É–Ω–∫—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç** —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è ‚Äî —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î –¥–ª—è –Ω–æ–≤—ã—Ö –ø–∞–ø–æ–∫ –Ω–∞ –¥–∏—Å–∫–µ, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–¥–∞–ª–∏—Ç—å –¥–ª—è –ø—Ä–æ–ø–∞–≤—à–∏—Ö. –ù–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ —Ä–µ—à–∏–ª —Å–¥–µ–ª–∞—Ç—å –µ—ë **—Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—é—â–µ–π**: –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `SyncReport` –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç.

**–ü–ª—é—Å—ã:**
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–∞—á–∞–ª–∞ –≤–∏–¥–∏—Ç –æ—Ç—á—ë—Ç.
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∞, –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ö–æ–º–∞–Ω–¥–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `omniscope folder sync`, –Ω–æ —Ä–µ–∞–ª—å–Ω–æ –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ `status`. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–ø—É—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ ‚Äî –ª–∏–±–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `folder status`, –ª–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `--apply` –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

---

### `FolderTemplate::from_str` –≤–º–µ—Å—Ç–æ `std::str::FromStr`

–î–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫–∏ —à–∞–±–ª–æ–Ω–∞ –∏–∑ CLI (`"personal"`, `"research"`, `"technical"`) –¥–æ–±–∞–≤–∏–ª –º–µ—Ç–æ–¥ `from_str` –ø—Ä—è–º–æ –Ω–∞ enum. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Rust –ø—É—Ç—å ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–µ–π—Ç `std::str::FromStr` —Å –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º `Err`.

–Ø –Ω–µ —Å–¥–µ–ª–∞–ª —ç—Ç–æ–≥–æ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ error-—Ç–∏–ø–∞ —Ä–∞–¥–∏ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥, –∫–æ–≥–¥–∞ —Ç–∞–º –≤—Å–µ–≥–æ —Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏ caller (CLI) —Å–∞–º —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ. `Option<FolderTemplate>` ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

–ù–æ –µ—Å–ª–∏ `FolderTemplate` –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —Å—Ç–∞–Ω–µ—Ç —á–∞—Å—Ç—å—é –ø—É–±–ª–∏—á–Ω–æ–≥–æ API –∫—Ä–µ–π—Ç–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `FromStr` —Å—Ä–∞–∑—É.

---

## üß™ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –ø–æ —Ç–µ—Å—Ç–∞–º

–ß—Ç–æ **–Ω–µ** –ø–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏ –∏ –±—ã–ª–æ –±—ã –≤–∞–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **`scan` –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞—Ö–æ–¥–∏—Ç—å –≤ `.libr/`** ‚Äî –∏–Ω–∞—á–µ JSON-–∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è "–∫–Ω–∏–≥–∞–º–∏". –°–µ–π—á–∞—Å —ç—Ç–æ –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è —è–≤–Ω–æ.

2. **–ë–∏—Ç—ã–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏** ‚Äî —á—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –µ—Å—Ç—å `symlink` –≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª? –°–µ–π—á–∞—Å `scan_directory` –∏—Ç–µ—Ä–∏—Ä—É–µ—Ç `read_dir`, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –±–∏—Ç—ã—Ö —Å—Å—ã–ª–∫–∞—Ö –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ.

3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** ‚Äî `create_folder_on_disk` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–Ω–∞ –¥–∞–≤–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—É—é –æ—à–∏–±–∫—É, –∞ –Ω–µ –ø–∞–Ω–∏–∫–æ–≤–∞—Ç—å. –ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ.

4. **Idempotency `scan --auto-create-cards`** ‚Äî –≤—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ –ø–æ–¥—Ä—è–¥ –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–æ–º `test_scan_skips_known_files`, –Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É `known_files: 1`. –°—Ç–æ–∏—Ç —è–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ DB —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–æ–≤–Ω–æ 1 –∑–∞–ø–∏—Å—å –ø–æ—Å–ª–µ –¥–≤—É—Ö –∑–∞–ø—É—Å–∫–æ–≤.

5. **CLI exit codes** ‚Äî `omniscope scan` –ø—Ä–∏ –æ—à–∏–±–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏) –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ–Ω—É–ª–µ–≤–æ–π exit code. –ù–µ –ø–æ–∫—Ä—ã—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ `assert_cmd`.

---

## ‚úÖ –ß—Ç–æ –≤—ã—à–ª–æ —Ö–æ—Ä–æ—à–æ

- –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è: `folders.rs` –∏ `scan.rs` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —á—ë—Ç–∫–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é, –Ω–µ —Å–º–µ—à–∞–Ω—ã –≤ `database.rs`.
- Incremental migration (v3) –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –≤–ø–∏—Å–∞–ª–∞—Å—å –≤ —É–∂–µ —É—Å—Ç–æ—è–≤—à–∏–π—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∞.
- 143 —Ç–µ—Å—Ç–∞, –≤—Å–µ –∑–µ–ª—ë–Ω—ã–µ.
- E2E –ø—Ä–æ–≤–µ—Ä–µ–Ω –≤—Ä—É—á–Ω—É—é: `init ‚Üí scaffold ‚Üí scan ‚Üí auto-create ‚Üí folder sync ‚Üí doctor`.
